{
  "input": { 
    "description": "It should run Destroy VPC and EC2 Instance if there are multiple instances", 
    "variables": { 
      "vpcId": "vpc-0b678b7a21e66ded8", 
      "adapterId": "EC2" 
    } 
  },
  "expectedTaskResults": {
    "status": "complete",
    "variables": {
      "vpcId": "vpc-0b678b7a21e66ded8",
      "adapterId": "EC2"
    }
  },
  "stubTasks": [
    {
      "taskId": "6253",
      "variables": {
        "incoming": { "vpcId": "vpc-0b678b7a21e66ded8", "dryRun": false },
        "outgoing": {
          "result": {
            "icode": "AD.200",
            "response": { "DeleteVpcResponse": { "_attr": { "xmlns": "http://ec2.amazonaws.com/doc/2016-11-15/" }, "requestId": "7928299a-a5a2-43c8-b328-bf4edf2b96e5", "return": "true" } }
          }
        }
      }
    },
    {
      "taskId": "9653",
      "variables": {
        "incoming": { "filter": [{ "name": "network-interface.vpc-id", "value": "vpc-0b678b7a21e66ded8" }], "instanceId": "", "dryRun": false, "maxResults": "", "nextToken": "" },
        "outgoing": {
          "result": {
            "icode": "AD.200",
            "response": {
              "DescribeInstancesResponse": {
                "_attr": { "xmlns": "http://ec2.amazonaws.com/doc/2016-11-15/" },
                "requestId": "d94bcfa7-7a3f-45ca-b45a-63ed4a5c7782",
                "reservationSet": {
                  "item": [
                    {
                      "reservationId": "r-0a3f95c92889e7686",
                      "ownerId": "314014972859",
                      "groupSet": "",
                      "instancesSet": {
                        "item": {
                          "instanceId": "i-0800682bc8424d01d",
                          "imageId": "ami-0df435f331839b2d6",
                          "instanceState": { "code": "16", "name": "running" },
                          "privateDnsName": "ip-10-20-30-11.ec2.internal",
                          "dnsName": "",
                          "reason": "",
                          "amiLaunchIndex": "0",
                          "productCodes": "",
                          "instanceType": "t2.micro",
                          "launchTime": "2023-10-23T02:33:58.000Z",
                          "placement": { "availabilityZone": "us-east-1d", "groupName": "", "tenancy": "default" },
                          "monitoring": { "state": "disabled" },
                          "subnetId": "subnet-0441602418891d0b3",
                          "vpcId": "vpc-0b678b7a21e66ded8",
                          "privateIpAddress": "10.20.30.11",
                          "sourceDestCheck": "true",
                          "groupSet": { "item": { "groupId": "sg-0b4ab83c40750dbd9", "groupName": "launch-wizard-1" } },
                          "architecture": "x86_64",
                          "rootDeviceType": "ebs",
                          "rootDeviceName": "/dev/xvda",
                          "blockDeviceMapping": {
                            "item": {
                              "deviceName": "/dev/xvda",
                              "ebs": { "volumeId": "vol-0bd1b2128f4ec1492", "status": "attached", "attachTime": "2023-10-23T02:33:59.000Z", "deleteOnTermination": "true" }
                            }
                          },
                          "virtualizationType": "hvm",
                          "clientToken": "78dda52d-a0d2-4ee5-834f-eb5a68e96995",
                          "hypervisor": "xen",
                          "networkInterfaceSet": {
                            "item": {
                              "networkInterfaceId": "eni-0d805d7c76169f987",
                              "subnetId": "subnet-0441602418891d0b3",
                              "vpcId": "vpc-0b678b7a21e66ded8",
                              "description": "",
                              "ownerId": "314014972859",
                              "status": "in-use",
                              "macAddress": "0a:b6:7a:04:83:83",
                              "privateIpAddress": "10.20.30.11",
                              "sourceDestCheck": "true",
                              "groupSet": { "item": { "groupId": "sg-0b4ab83c40750dbd9", "groupName": "launch-wizard-1" } },
                              "attachment": {
                                "attachmentId": "eni-attach-05293c9bfe3536ff5",
                                "deviceIndex": "0",
                                "status": "attached",
                                "attachTime": "2023-10-23T02:33:58.000Z",
                                "deleteOnTermination": "true",
                                "networkCardIndex": "0"
                              },
                              "privateIpAddressesSet": { "item": { "privateIpAddress": "10.20.30.11", "primary": "true" } },
                              "ipv6AddressesSet": "",
                              "interfaceType": "interface"
                            }
                          },
                          "ebsOptimized": "false",
                          "enaSupport": "true",
                          "cpuOptions": { "coreCount": "1", "threadsPerCore": "1" },
                          "capacityReservationSpecification": { "capacityReservationPreference": "open" },
                          "hibernationOptions": { "configured": "false" },
                          "enclaveOptions": { "enabled": "false" },
                          "metadataOptions": {
                            "state": "applied",
                            "httpTokens": "required",
                            "httpPutResponseHopLimit": "2",
                            "httpEndpoint": "enabled",
                            "httpProtocolIpv4": "enabled",
                            "httpProtocolIpv6": "disabled",
                            "instanceMetadataTags": "disabled"
                          },
                          "maintenanceOptions": { "autoRecovery": "default" },
                          "bootMode": "uefi-preferred",
                          "currentInstanceBootMode": "legacy-bios",
                          "platformDetails": "Linux/UNIX",
                          "usageOperation": "RunInstances",
                          "usageOperationUpdateTime": "2023-10-23T02:33:58.000Z",
                          "privateDnsNameOptions": { "hostnameType": "ip-name", "enableResourceNameDnsARecord": "false", "enableResourceNameDnsAAAARecord": "false" }
                        }
                      }
                    },
                    {
                      "reservationId": "r-0c70e1f9c78e43292",
                      "ownerId": "314014972859",
                      "groupSet": "",
                      "instancesSet": {
                        "item": {
                          "instanceId": "i-0aa471156ef725efb",
                          "imageId": "ami-0df435f331839b2d6",
                          "instanceState": { "code": "16", "name": "running" },
                          "privateDnsName": "ip-10-20-30-13.ec2.internal",
                          "dnsName": "",
                          "reason": "",
                          "amiLaunchIndex": "0",
                          "productCodes": "",
                          "instanceType": "t2.micro",
                          "launchTime": "2023-10-23T02:34:37.000Z",
                          "placement": { "availabilityZone": "us-east-1d", "groupName": "", "tenancy": "default" },
                          "monitoring": { "state": "disabled" },
                          "subnetId": "subnet-0441602418891d0b3",
                          "vpcId": "vpc-0b678b7a21e66ded8",
                          "privateIpAddress": "10.20.30.13",
                          "sourceDestCheck": "true",
                          "groupSet": { "item": { "groupId": "sg-0eda4a5b5d865a205", "groupName": "launch-wizard-4" } },
                          "architecture": "x86_64",
                          "rootDeviceType": "ebs",
                          "rootDeviceName": "/dev/xvda",
                          "blockDeviceMapping": {
                            "item": {
                              "deviceName": "/dev/xvda",
                              "ebs": { "volumeId": "vol-09f2ebe4a3e517f61", "status": "attached", "attachTime": "2023-10-23T02:34:38.000Z", "deleteOnTermination": "true" }
                            }
                          },
                          "virtualizationType": "hvm",
                          "clientToken": "86c01232-318b-4815-bbc6-4bb8d743fe0a",
                          "tagSet": { "item": { "key": "Name", "value": "test" } },
                          "hypervisor": "xen",
                          "networkInterfaceSet": {
                            "item": {
                              "networkInterfaceId": "eni-0d32e17dec64badec",
                              "subnetId": "subnet-0441602418891d0b3",
                              "vpcId": "vpc-0b678b7a21e66ded8",
                              "description": "",
                              "ownerId": "314014972859",
                              "status": "in-use",
                              "macAddress": "0a:6b:a6:ea:0a:1b",
                              "privateIpAddress": "10.20.30.13",
                              "sourceDestCheck": "true",
                              "groupSet": { "item": { "groupId": "sg-0eda4a5b5d865a205", "groupName": "launch-wizard-4" } },
                              "attachment": {
                                "attachmentId": "eni-attach-04cffb03f28ec1397",
                                "deviceIndex": "0",
                                "status": "attached",
                                "attachTime": "2023-10-23T02:34:37.000Z",
                                "deleteOnTermination": "true",
                                "networkCardIndex": "0"
                              },
                              "privateIpAddressesSet": { "item": { "privateIpAddress": "10.20.30.13", "primary": "true" } },
                              "ipv6AddressesSet": "",
                              "interfaceType": "interface"
                            }
                          },
                          "ebsOptimized": "false",
                          "enaSupport": "true",
                          "cpuOptions": { "coreCount": "1", "threadsPerCore": "1" },
                          "capacityReservationSpecification": { "capacityReservationPreference": "open" },
                          "hibernationOptions": { "configured": "false" },
                          "enclaveOptions": { "enabled": "false" },
                          "metadataOptions": {
                            "state": "applied",
                            "httpTokens": "required",
                            "httpPutResponseHopLimit": "2",
                            "httpEndpoint": "enabled",
                            "httpProtocolIpv4": "enabled",
                            "httpProtocolIpv6": "disabled",
                            "instanceMetadataTags": "disabled"
                          },
                          "maintenanceOptions": { "autoRecovery": "default" },
                          "bootMode": "uefi-preferred",
                          "currentInstanceBootMode": "legacy-bios",
                          "platformDetails": "Linux/UNIX",
                          "usageOperation": "RunInstances",
                          "usageOperationUpdateTime": "2023-10-23T02:34:37.000Z",
                          "privateDnsNameOptions": { "hostnameType": "ip-name", "enableResourceNameDnsARecord": "false", "enableResourceNameDnsAAAARecord": "false" }
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        }
      }
    },
    {
      "taskId": "992b",
      "variables": {
        "incoming": { "instanceId": ["i-0800682bc8424d01d", "i-0aa471156ef725efb"], "dryRun": false },
        "outgoing": {
          "result": {
            "icode": "AD.200",
            "response": {
              "TerminateInstancesResponse": {
                "_attr": { "xmlns": "http://ec2.amazonaws.com/doc/2016-11-15/" },
                "requestId": "fa9d423e-2011-4834-bde8-a90c25337ffb",
                "instancesSet": {
                  "item": [
                    { "instanceId": "i-0aa471156ef725efb", "currentState": { "code": "32", "name": "shutting-down" }, "previousState": { "code": "16", "name": "running" } },
                    { "instanceId": "i-0800682bc8424d01d", "currentState": { "code": "32", "name": "shutting-down" }, "previousState": { "code": "16", "name": "running" } }
                  ]
                }
              }
            }
          }
        }
      }
    },
    {
      "taskId": "e0fe",
      "variables": {
        "incoming": { "filter": "", "vpcId": ["vpc-0b678b7a21e66ded8"], "dryRun": false, "nextToken": "", "maxResults": "" },
        "outgoing": {
          "result": {
            "icode": "AD.200",
            "response": {
              "DescribeVpcsResponse": {
                "_attr": { "xmlns": "http://ec2.amazonaws.com/doc/2016-11-15/" },
                "requestId": "0d42c765-cbb2-4076-b9db-42ab7251fe8c",
                "vpcSet": {
                  "item": {
                    "vpcId": "vpc-0b678b7a21e66ded8",
                    "ownerId": "314014972859",
                    "state": "available",
                    "cidrBlock": "10.20.30.0/28",
                    "cidrBlockAssociationSet": { "item": { "cidrBlock": "10.20.30.0/28", "associationId": "vpc-cidr-assoc-0c49eb49f4fb7d386", "cidrBlockState": { "state": "associated" } } },
                    "dhcpOptionsId": "dopt-045a5c88c0d702d2b",
                    "tagSet": {
                      "item": [
                        { "key": "Workshop-Instance", "value": "true" },
                        { "key": "Name", "value": "Test VPC1234" }
                      ]
                    },
                    "instanceTenancy": "default",
                    "isDefault": "false"
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "taskId": "9b69",
      "variables": {
        "incoming": {
          "task": "9b69",
          "workflow": "Delete Subnets by VPC - AWS",
          "variables": { "vpcId": { "editable": false, "task": "job", "value": "vpcId" }, "adapterId": { "task": "job", "value": "adapterId" } },
          "data_array": "",
          "transformation": "",
          "loopType": ""
        },
        "outgoing": {
          "job_details": {
            "status": "complete",
            "vpcId": "vpc-0b678b7a21e66ded8",
            "adapterId": "EC2",
            "_id": "f0c561943bfc4b559a0797f6",
            "initiator": "admin@pronghorn",
            "deletedSubnet": [
              {
                "icode": "AD.200",
                "response": { "DeleteSubnetResponse": { "_attr": { "xmlns": "http://ec2.amazonaws.com/doc/2016-11-15/" }, "requestId": "1dde58fa-ae0d-42db-a6f4-9a047994da74", "return": "true" } },
                "headers": {
                  "x-amzn-requestid": "1dde58fa-ae0d-42db-a6f4-9a047994da74",
                  "cache-control": "no-cache, no-store",
                  "strict-transport-security": "max-age=31536000; includeSubDomains",
                  "content-type": "text/xml;charset=UTF-8",
                  "content-length": "225",
                  "date": "Mon, 23 Oct 2023 02:45:45 GMT",
                  "keep-alive": "timeout=20",
                  "server": "AmazonEC2",
                  "connection": "close"
                },
                "metrics": { "code": 200, "timeouts": 0, "redirects": 0, "retries": 0, "tripTime": 577, "isThrottling": false, "capabilityTime": "846ms" }
              }
            ]
          }
        }
      }
    },
    {
      "taskId": "cac5",
      "variables": {
        "incoming": {
          "task": "cac5",
          "workflow": "Detach and Delete Internet Gateways by VPC - AWS",
          "variables": { "vpcId": { "task": "job", "value": "vpcId" }, "adapterId": { "task": "job", "value": "adapterId" } },
          "data_array": "",
          "transformation": "",
          "loopType": ""
        },
        "outgoing": {
          "job_details": {
            "status": "complete",
            "vpcId": "vpc-0b678b7a21e66ded8",
            "adapterId": "EC2",
            "_id": "87dcf97011de4d04b55dd50a",
            "initiator": "admin@pronghorn",
            "deletedInternetGateway": {
              "icode": "AD.200",
              "response": {
                "DeleteInternetGatewayResponse": { "_attr": { "xmlns": "http://ec2.amazonaws.com/doc/2016-11-15/" }, "requestId": "99fca0cf-09f3-402f-9eb8-a022268118fd", "return": "true" }
              },
              "headers": {
                "x-amzn-requestid": "99fca0cf-09f3-402f-9eb8-a022268118fd",
                "cache-control": "no-cache, no-store",
                "strict-transport-security": "max-age=31536000; includeSubDomains",
                "content-type": "text/xml;charset=UTF-8",
                "content-length": "243",
                "date": "Mon, 23 Oct 2023 02:45:50 GMT",
                "keep-alive": "timeout=20",
                "server": "AmazonEC2",
                "connection": "close"
              },
              "metrics": { "code": 200, "timeouts": 0, "redirects": 0, "retries": 0, "tripTime": 315, "isThrottling": false, "capabilityTime": "554ms" }
            }
          }
        }
      }
    },
    {
      "taskId": "ab1",
      "variables": {
        "incoming": { "filter": [{ "name": "network-interface.vpc-id", "value": "vpc-0b678b7a21e66ded8" }], "instanceId": "", "dryRun": false, "maxResults": "", "nextToken": "" },
        "outgoing": {
          "result": {
            "icode": "AD.200",
            "response": {
              "DescribeInstancesResponse": {
                "_attr": { "xmlns": "http://ec2.amazonaws.com/doc/2016-11-15/" },
                "requestId": "2453a946-ef99-4cbd-940b-3cc3452a39d8",
                "reservationSet": ""
              }
            }
          }
        }
      }
    },
    {
      "taskId": "a879",
      "variables": {
        "incoming": {
          "task": "a879",
          "workflow": "Delete Security Groups by VPC - AWS",
          "variables": { "vpcId": { "editable": false, "task": "job", "value": "vpcId" }, "adapterId": { "task": "job", "value": "adapterId" } },
          "data_array": "",
          "transformation": "",
          "loopType": ""
        },
        "outgoing": {
          "job_details": {
            "status": "complete",
            "vpcId": "vpc-0b678b7a21e66ded8",
            "adapterId": "EC2",
            "_id": "a44f5186bffb498daea07630",
            "initiator": "admin@pronghorn",
            "deletedSecurityGroup": [
              {
                "icode": "AD.200",
                "response": {
                  "DeleteSecurityGroupResponse": { "_attr": { "xmlns": "http://ec2.amazonaws.com/doc/2016-11-15/" }, "requestId": "57b582d4-8abe-4ce2-84ed-a251558c9e09", "return": "true" }
                },
                "headers": {
                  "x-amzn-requestid": "57b582d4-8abe-4ce2-84ed-a251558c9e09",
                  "cache-control": "no-cache, no-store",
                  "strict-transport-security": "max-age=31536000; includeSubDomains",
                  "content-type": "text/xml;charset=UTF-8",
                  "content-length": "239",
                  "date": "Mon, 23 Oct 2023 02:45:36 GMT",
                  "keep-alive": "timeout=20",
                  "server": "AmazonEC2",
                  "connection": "close"
                },
                "metrics": { "code": 200, "timeouts": 0, "redirects": 0, "retries": 0, "tripTime": 1321, "isThrottling": false, "capabilityTime": "1613ms" }
              },
              {
                "icode": "AD.200",
                "response": {
                  "DeleteSecurityGroupResponse": { "_attr": { "xmlns": "http://ec2.amazonaws.com/doc/2016-11-15/" }, "requestId": "111a492f-170d-40df-9733-7f5e0183b67f", "return": "true" }
                },
                "headers": {
                  "x-amzn-requestid": "111a492f-170d-40df-9733-7f5e0183b67f",
                  "cache-control": "no-cache, no-store",
                  "strict-transport-security": "max-age=31536000; includeSubDomains",
                  "content-type": "text/xml;charset=UTF-8",
                  "content-length": "239",
                  "date": "Mon, 23 Oct 2023 02:45:35 GMT",
                  "keep-alive": "timeout=20",
                  "server": "AmazonEC2",
                  "connection": "close"
                },
                "metrics": { "code": 200, "timeouts": 0, "redirects": 0, "retries": 0, "tripTime": 463, "isThrottling": false, "capabilityTime": "900ms" }
              }
            ]
          }
        }
      }
    }
  ]
}
